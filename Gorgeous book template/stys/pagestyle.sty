%%%%=======================================================%%%%
\def\fileversion{v1.0}
\def\filename{pagestyle}
\def\filetitle{pagestyle package}
\def\filedate{2022/05/22}
\def\docdate {2022/05/22}
\def\fontspath{Fonts/}
\def\graphics{Figures/}
%%%%========================================================%%%%
\NeedsTeXFormat{LaTeX2e}[1995/12/01]
\ProvidesPackage{stys/pagestyle}[2022/05/21,v1.0]
%%%%========================================================%%%%
%-----------------------------------   页面设计依赖元素   --------------------------------------------------%
%%------------------------------------ Input Needed Packages -------------------------------------%%
\RequirePackage[dvipsnames,svgnames,x11names]{xcolor} %颜色
\definecolor{cor1}{RGB}{0,165,157}
\definecolor{cor2}{RGB}{73,85,93}
\definecolor{session1}{HTML}{508E99}
%
\RequirePackage{tikz} %画图  %%页面样式设计核心包
\usetikzlibrary{intersections,spy, positioning, fit, backgrounds, shapes, fadings,
decorations.pathmorphing, graphs, quotes, angles, calc, through, backgrounds} % %Tikz指令库
%spy-局部放大包
\RequirePackage{pgfplots} %画图 %%页面样式设计核心包 %提供\pgfonlayer命令以及下列图层指令
% Define the layers to be used in document.
% *****************************************************
\pgfdeclarelayer{background} %背景%底层
\pgfdeclarelayer{foreground} %上层
\pgfdeclarelayer{top} %顶部
\pgfdeclarelayer{bottom} %底部
\pgfsetlayers{bottom,background,main,foreground,top}
%-----------------------------------   页面设计依赖元素   --------------------------------------------------%
%%%%========================================================%%%%


%%普通包添加区
\RequirePackage{tikz-3dplot} %
\RequirePackage{tkz-euclide} % 画平面几何图形
\RequirePackage[inline, attach]{asymptote} % the Vector Graphics Language 画向量
\RequirePackage[dvips]{attachfile2} % asymptote依赖包
\RequirePackage{tcolorbox} % Allow those nice environments
\tcbuselibrary{theorems, listings, breakable, most, skins}


%%=============== Begin The Design Of Page Style
% ****************************************************
% =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
% Even (left) page number command 偶数页（左边）设置
% *****************************************************
\newcommand{\leftpagenumber}{%
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (bottom) at ($(current page.south west) + (13.50mm,6.80mm)$); %定义一个点bottom在页面西南角的位置
            \begin{pgfonlayer}{main}
% 偶数页（页码边框设置）左边页码
% ------------------------------------------------------
                % Square for page number
        \filldraw [fill=cor2, draw=cor2,rounded corners=3pt] (bottom) rectangle ++(-15.00mm,20.00mm) coordinate (corner);
        \filldraw [fill=cor1, draw=cor1,rounded corners=3pt] (bottom) rectangle ++(-8.00mm,8.00mm) coordinate (corner); %coordinate用于定义一个点
            \end{pgfonlayer}
% 偶数页（左边页码格式设置）
% ------------------------------------------------------
            \begin{pgfonlayer}{foreground}
                \node [text=white, scale=2,font=\bfseries\large](page_number) at ($(bottom)!0.5!(corner)$) {\thepage};
            \end{pgfonlayer}
    \end{tikzpicture}
}

% Odd (right) page number command 奇数页（左边）设置
% ******************************************************
\newcommand{\rightpagenumber}{
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (bottom) at ($(current page.south east) + (-13.50mm,6.80mm)$);
            \begin{pgfonlayer}{main}

% 奇数页（页码边框设置）右边页码设置
% ------------------------------------------------------
                \filldraw [fill=session1, draw=session1,rounded corners=3pt] (bottom) rectangle ++(8.00mm,8.00mm) coordinate (corner);
            \end{pgfonlayer}

            \begin{pgfonlayer}{foreground}
                \node [text=white, font=\bfseries\large](page_number) at ($(bottom)!0.5!(corner)$) {\thepage};
            \end{pgfonlayer}

    \end{tikzpicture}
}
% Draw headers. This places the tabs on the side of the page
\newcommand{\leftpagetab}{
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (bottom) at ($(current page.south west) + (18.00mm,0.00mm)$);
% 右边竖线盒子设置
% ------------------------------------------------------
    \filldraw [fill=cor2, draw=cor2] ($(current page.north east) + (-18.00mm,0.00mm)$) rectangle ++(8.00mm,-8.00mm) coordinate (taba) {}; %把矩形所处位置点标记为(taba)

% Square for chapter number
    \coordinate (tabb) at ($(taba) + (-8.00mm,-8.00mm)$);
    \coordinate (tabc) at ($(tabb) + (4.00mm,0.00mm)$);
    \node [fill=cor1, text=white, minimum height=8.00mm, minimum width=8.00mm,font=\sandbox] (chapternumber) at ($(tabb)!0.5!(taba)$) {\Large\thechapter};
    \filldraw [fill=cor2, draw=cor2] ($(current page.north east) + (-18.00mm,-26.00mm)$) -- ++(8.00mm,0.00mm) -- ++(0.00mm,-8.50mm) -| cycle;

% Add chapter name
% 右边竖线内填入章节名称
% ****************************************************
        \node [fill=cor2, text=white,font=\sandbox] (chaptertitle) at (tabb) [rotate=90, below left, minimum height = 8.00mm] {\large \MakeUppercase{\chaptername}};

% Add end tab
% 右边竖框末尾
% ****************************************************
        \fill [fill=cor2] ([yshift=-2mm]chaptertitle.north west) -- ++(0.00mm,-4.00mm) coordinate (t1) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm]  -- ++(4.00mm,0.00mm) arc [start angle=270, end angle=360, x radius=2.00mm, y radius=2.00mm] coordinate (t2) -| cycle;


% Add chapter name
% 右边竖线内填入章节名称（框外）
% ****************************************************
        \node (chaptertitle) at ($(t1)!0.5!(t2)$) [left, rotate=90, text=coverfgcolor] {\large\bfseries  \rightmark};
    \end{tikzpicture}
}

% 最大的竖直框
\newcommand{\rightpagetab}{
    \begin{tikzpicture}[remember picture, overlay]
        \filldraw [fill=session1, draw=session1] (current page.north west) rectangle ($(current page.south west) + (18.00mm,0.00mm)$) coordinate (bottom) {};
        \coordinate (bottom) at ($(current page.south west) + (18.00mm,0.00mm)$);

        % Draw color block
        \filldraw [fill=cor2, draw=cor2] ($(current page.north west) + (18.00mm,0.00mm)$) rectangle ++(-8.00mm,-8.00mm) coordinate (taba) {};

        % Square for chapter number
        \coordinate (tabb) at ($(taba) + (8.00mm,-8.00mm)$);
        \coordinate (tabc) at ($(tabb) + (4.00mm,0.00mm)$);
        \node [fill=cor1, text=white, minimum height=8.00mm, minimum width=8.00mm,font=\sandbox] (chapternumber) at ($(tabb)!0.5!(taba)$) {\Large\thechapter};

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%########################################################################%
%%%%%%%%%%                                        问题代码                                             %%%%%%%%%%
        % Add chapter name
        \node [fill=cor2, text=white,font=\sandbox] (chaptertitle) at (tabb) [rotate=90, above left, minimum height = 8.00mm] {\large\MakeUppercase{\chaptername}};

        % Add end tab
        \filldraw [fill=cor2, draw=cor2] (chaptertitle.south west) -- ++(0.00mm,-4.00mm) coordinate (t1) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- ++(-4.00mm,0.00mm) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] coordinate (t2) -| cycle;
%%%%%%%%%%                                        问题代码                                             %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%########################################################################%

        % Add chapter title
        \node (chaptertitle) at ($(t1)!0.5!(t2)$) [left, rotate=90, text=white, xshift=-0.00mm] {\large\bfseries\leftmark};

        % Square for page number
        %\filldraw [fill=cor1, draw=cor1] ($(bottom) + (0.00mm, 20.00mm)$) rectangle ++(8.00mm,8.00mm);
    \end{tikzpicture}
}

% Setup page
% 章节标题设置
% *****************************************************

\makepagestyle{plain}
\makeevenfoot{plain}{}{\leftpagenumber}{}
\makeoddfoot{plain}{}{\rightpagenumber}{}
\makepagestyle{pagestyle}
\makeevenfoot{pagestyle}{}{\leftpagenumber}{}
\makeoddfoot{pagestyle}{}{\rightpagenumber}{}
\makeevenhead{pagestyle}{}{\rightpagetab}{}
\makeoddhead{pagestyle}{}{\leftpagetab}{}
\chapterstyle{pagestyle}
\pagestyle{pagestyle}

\endinput
